// import React from 'react'
// import { View } from 'react-native'
// import { styles } from './styles'

// const RewardsScreen = () => {

//     return (
//         <View style={{ flex: 1, backgroundColor: "red" }}>

//         </View>
//     )
// }
// export default RewardsScreen

import React, {useState, useRef} from 'react';
import {View, StyleSheet, Text, Button, Alert} from 'react-native';
import Svg, {Path, Circle} from 'react-native-svg';
import {SketchCanvas} from '@sourcetoad/react-native-sketch-canvas';
import textRecognition from '@react-native-ml-kit/text-recognition';
import RNFS from 'react-native-fs';

// Point-in-Polygon Helper Function
const isPointInPolygon = (point, polygon) => {
  let {x, y} = point;
  let isInside = false;

  for (let i = 0, j = polygon.length - 1; i < polygon.length; j = i++) {
    const xi = polygon[i].x,
      yi = polygon[i].y;
    const xj = polygon[j].x,
      yj = polygon[j].y;

    const intersect =
      yi > y !== yj > y && x < ((xj - xi) * (y - yi)) / (yj - yi) + xi;
    if (intersect) isInside = !isInside;
  }
  return isInside;
};

const RewardsScreen = () => {
  const [feedback, setFeedback] = useState('');
  const [recognizedText, setRecognizedText] = useState('');
  const [isRecognizing, setIsRecognizing] = useState(false);
  const canvasRef = useRef(null);

  // Guide Shape Definition
  const guide = [
    [570.8000183105469, 570.8000183105469],
    [560.8181610107422, 570.8000183105469],
    [550.8362579345703, 570.8000183105469],
    [540.8544006347656, 570.8000183105469],
    [530.8725433349609, 570.8000183105469],
    [520.8906402587891, 570.8000183105469],
    [510.9087829589844, 570.8000183105469],
    [500.9269256591797, 570.8000183105469],
    [490.9450225830078, 570.8000183105469],
    [480.9631652832031, 570.8000183105469],
    [470.98130798339844, 570.8000183105469],
    [460.99940490722656, 570.8000183105469],
    [451.0175476074219, 570.8000183105469],
    [441.0356903076172, 570.8000183105469],
    [431.42384338378906, 569.1271667480469],
    [427.0672149658203, 560.4221496582031],
    [424.6743927001953, 550.7313385009766],
    [422.2816162109375, 541.0404815673828],
    [419.8887939453125, 531.3496704101562],
    [417.4960174560547, 521.6588134765625],
    [415.1031951904297, 511.96800231933594],
    [412.7104187011719, 502.2771453857422],
    [410.3175964355469, 492.58628845214844],
    [407.92481994628906, 482.8954772949219],
    [405.53199768066406, 473.2046203613281],
    [400.40911865234375, 466.9999542236328],
    [390.42723846435547, 466.9999542236328],
    [380.4453582763672, 467],
    [370.4635009765625, 467],
    [360.4816207885742, 467],
    [350.49974060058594, 467],
    [340.51788330078125, 467],
    [330.53600311279297, 467],
    [320.5541229248047, 467],
    [310.572265625, 467],
    [300.5903854370117, 467],
    [290.60850524902344, 467],
    [280.62664794921875, 467],
    [270.64476776123047, 467],
    [260.6628875732422, 467],
    [250.6810302734375, 467],
    [240.69912719726562, 467],
    [234.55699157714844, 472.0818176269531],
    [231.83043670654297, 481.68409729003906],
    [229.1038589477539, 491.286376953125],
    [226.37728118896484, 500.88865661621094],
    [223.65072631835938, 510.4908905029297],
    [220.9241485595703, 520.0932159423828],
    [218.19757080078125, 529.6954498291016],
    [215.47101593017578, 539.2977294921875],
    [212.74443817138672, 548.8999633789062],
    [210.01787185668945, 558.5022888183594],
    [206.3424072265625, 567.658935546875],
    [197.0439682006836, 570.1999816894531],
    [187.06206512451172, 570.1999816894531],
    [177.08020782470703, 570.1999816894531],
    [167.09835052490234, 570.1999816894531],
    [157.11644744873047, 570.1999816894531],
    [147.13459014892578, 570.1999816894531],
    [137.1527328491211, 570.1999816894531],
    [127.17082977294922, 570.1999816894531],
    [117.18897247314453, 570.1999816894531],
    [107.20710945129395, 570.1999816894531],
    [97.22520637512207, 570.1999816894531],
    [87.24334907531738, 570.1999816894531],
    [77.2614917755127, 570.1999816894531],
    [67.29804515838623, 569.97119140625],
    [60.78449726104736, 563.0896759033203],
    [62.428375244140625, 553.3517608642578],
    [65.0234146118164, 543.7130889892578],
    [67.6184310913086, 534.0744171142578],
    [70.21344757080078, 524.435791015625],
    [72.80847549438477, 514.797119140625],
    [75.40349197387695, 505.1584930419922],
    [77.99850845336914, 495.5198211669922],
    [80.59353637695312, 485.8811492919922],
    [83.18856430053711, 476.2425231933594],
    [85.7835807800293, 466.60389709472656],
    [88.37860870361328, 456.9651794433594],
    [90.97363662719727, 447.3265075683594],
    [93.56864166259766, 437.68792724609375],
    [96.16367530822754, 428.04920959472656],
    [98.75870323181152, 418.41053771972656],
    [101.35370826721191, 408.77195739746094],
    [103.9487419128418, 399.13326263427734],
    [106.54376983642578, 389.49456787109375],
    [109.13877487182617, 379.85596466064453],
    [111.73380851745605, 370.21729278564453],
    [114.32883644104004, 360.57862091064453],
    [116.92383575439453, 350.9400177001953],
    [119.51887512207031, 341.3013229370117],
    [122.1139030456543, 331.6626510620117],
    [124.70890808105469, 322.0240478515625],
    [127.30393600463867, 312.3853759765625],
    [129.89896392822266, 302.7466812133789],
    [132.49398040771484, 293.1081008911133],
    [135.08899688720703, 283.4694061279297],
    [137.68401336669922, 273.83082580566406],
    [140.2790412902832, 264.19213104248047],
    [142.8740692138672, 254.55345916748047],
    [145.46907424926758, 244.91485595703125],
    [148.06410217285156, 235.27618408203125],
    [150.65914154052734, 225.63748931884766],
    [153.25414657592773, 215.99890899658203],
    [155.84917449951172, 206.36021423339844],
    [158.4442024230957, 196.72154235839844],
    [161.0392074584961, 187.08293914794922],
    [163.63423538208008, 177.44426727294922],
    [166.22926330566406, 167.80557250976562],
    [168.82427978515625, 158.1669807434082],
    [171.41930770874023, 148.5282974243164],
    [174.01433563232422, 138.8896255493164],
    [176.6093406677246, 129.2510223388672],
    [179.2043685913086, 119.61233901977539],
    [181.79939651489258, 109.9736557006836],
    [184.39440155029297, 100.33506393432617],
    [186.98944091796875, 90.69638061523438],
    [189.58446884155273, 81.05769729614258],
    [193.2737579345703, 71.91417121887207],
    [202.48204040527344, 69.19999885559082],
    [212.4639434814453, 69.19999885559082],
    [222.4457550048828, 69.19999885559082],
    [232.4276580810547, 69.19999885559082],
    [242.40956115722656, 69.19999885559082],
    [252.39137268066406, 69.19999885559082],
    [262.37327575683594, 69.19999885559082],
    [272.3551788330078, 69.19999885559082],
    [282.3369903564453, 69.19999885559082],
    [292.3188934326172, 69.19999885559082],
    [302.30079650878906, 69.19999885559082],
    [312.28260803222656, 69.19999885559082],
    [322.26451110839844, 69.19999885559082],
    [332.2464141845703, 69.19999885559082],
    [342.2282257080078, 69.19999885559082],
    [352.2101287841797, 69.19999885559082],
    [362.19203186035156, 69.19999885559082],
    [372.17384338378906, 69.19999885559082],
    [382.15574645996094, 69.19999885559082],
    [392.1376495361328, 69.19999885559082],
    [402.1194610595703, 69.19999885559082],
    [412.1013641357422, 69.19999885559082],
    [422.08326721191406, 69.19999885559082],
    [432.06507873535156, 69.19999885559082],
    [442.0420379638672, 69.30137634277344],
    [448.9601745605469, 75.66857719421387],
    [451.55926513671875, 85.30593872070312],
    [454.1543273925781, 94.94465637207031],
    [456.7493438720703, 104.58332824707031],
    [459.3443603515625, 114.22190856933594],
    [461.9393768310547, 123.86058044433594],
    [464.5343933105469, 133.49929809570312],
    [467.12940979003906, 143.13787841796875],
    [469.72442626953125, 152.77655029296875],
    [472.3194885253906, 162.41522216796875],
    [474.9144592285156, 172.05384826660156],
    [477.509521484375, 181.69261169433594],
    [480.1045379638672, 191.33119201660156],
    [482.6995544433594, 200.96979522705078],
    [485.29461669921875, 210.60855865478516],
    [487.88958740234375, 220.24716186523438],
    [490.48460388183594, 229.8857650756836],
    [493.0796661376953, 239.52452850341797],
    [495.6746826171875, 249.1631317138672],
    [498.2696533203125, 258.8017120361328],
    [500.8647155761719, 268.4404983520508],
    [503.45973205566406, 278.0790786743164],
    [506.05474853515625, 287.7176818847656],
    [508.6498107910156, 297.3564453125],
    [511.2447814941406, 306.9950485229492],
    [513.8397979736328, 316.63362884521484],
    [516.4348602294922, 326.2724151611328],
    [519.0298767089844, 335.91099548339844],
    [521.6248474121094, 345.54959869384766],
    [524.2199096679688, 355.18836212158203],
    [526.8149261474609, 364.82696533203125],
    [529.4099426269531, 374.4655456542969],
    [532.0050048828125, 384.10433197021484],
    [534.5999755859375, 393.74293518066406],
    [537.1949920654297, 403.3815155029297],
    [539.7900543212891, 413.02027893066406],
    [542.3850708007812, 422.6589050292969],
    [544.9800872802734, 432.2974853515625],
    [547.5751037597656, 441.9362487792969],
    [550.1701202392578, 451.5748291015625],
    [552.76513671875, 461.2134094238281],
    [555.3601989746094, 470.8522186279297],
    [557.9552154541016, 480.4907989501953],
    [560.5501861572266, 490.12937927246094],
    [563.1452484130859, 499.7681884765625],
    [565.7402648925781, 509.4067687988281],
    [568.3352813720703, 519.0453491210938],
    [570.9302520751953, 528.6839294433594],
    [573.5253143310547, 538.3227386474609],
    [576.1203308105469, 547.9613189697266],
    [578.7153472900391, 557.5998992919922],
    [577.6295776367188, 567.137451171875],
    [82.52528762817383, 553.4000091552734],
    [92.50709915161133, 553.4000091552734],
    [102.48909378051758, 553.4000091552734],
    [112.47090530395508, 553.4000091552734],
    [122.45271682739258, 553.4000091552734],
    [132.43471145629883, 553.4000091552734],
    [142.41652297973633, 553.4000091552734],
    [152.39833450317383, 553.4000091552734],
    [162.38032913208008, 553.4000091552734],
    [172.36214065551758, 553.4000091552734],
    [182.34395217895508, 553.4000091552734],
    [192.32594680786133, 553.4000091552734],
    [195.3970832824707, 544.2537994384766],
    [198.12363815307617, 534.6515655517578],
    [200.85023880004883, 525.0491943359375],
    [203.5767936706543, 515.4469604492188],
    [206.30334854125977, 505.8447723388672],
    [209.02994918823242, 496.2423553466797],
    [211.7565040588379, 486.6401672363281],
    [214.48304748535156, 477.0379333496094],
    [217.2096710205078, 467.43556213378906],
    [219.9362030029297, 457.8333282470703],
    [226.03627014160156, 450.58660888671875],
    [235.98114013671875, 450.1999816894531],
    [245.96295166015625, 450.1999816894531],
    [255.94476318359375, 450.1999816894531],
    [265.9267578125, 450.1999816894531],
    [275.9085693359375, 450.1999816894531],
    [285.890380859375, 450.1999816894531],
    [295.87237548828125, 450.1999816894531],
    [305.85418701171875, 450.1999816894531],
    [315.83599853515625, 450.1999816894531],
    [325.8179931640625, 450.1999816894531],
    [335.7998046875, 450.1999816894531],
    [345.7816162109375, 450.1999816894531],
    [355.76361083984375, 450.1999816894531],
    [365.74542236328125, 450.1999816894531],
    [375.72723388671875, 450.1999816894531],
    [385.709228515625, 450.1999816894531],
    [395.6910400390625, 450.1999816894531],
    [405.6728515625, 450.1999816894531],
    [415.218505859375, 452.0638122558594],
    [419.4067687988281, 460.8774108886719],
    [421.7995910644531, 470.56817626953125],
    [424.1924133300781, 480.25917053222656],
    [426.58518981933594, 489.94993591308594],
    [428.97796630859375, 499.6407012939453],
    [431.37078857421875, 509.33164978027344],
    [433.76356506347656, 519.0224151611328],
    [436.1563415527344, 528.7132263183594],
    [438.54920959472656, 538.4041748046875],
    [440.9419860839844, 548.0949401855469],
    [446.2994689941406, 554],
    [456.2814636230469, 554],
    [466.2632751464844, 554],
    [476.2450866699219, 554],
    [486.2270812988281, 554],
    [496.2088928222656, 554],
    [506.1907043457031, 554],
    [516.1726989746094, 554],
    [526.1545104980469, 554],
    [536.1363220214844, 554],
    [546.1183166503906, 554],
    [556.1001281738281, 554],
    [556.9214935302734, 546.9645385742188],
    [554.346435546875, 537.3204193115234],
    [551.7714233398438, 527.6764831542969],
    [549.1964111328125, 518.0325012207031],
    [546.6213073730469, 508.3883819580078],
    [544.0462951660156, 498.74444580078125],
    [541.4712829589844, 489.1004638671875],
    [538.8961791992188, 479.4563446044922],
    [536.3211669921875, 469.8124084472656],
    [533.7461547851562, 460.16847229003906],
    [531.1710968017578, 450.52430725097656],
    [528.5960388183594, 440.88037109375],
    [526.0210266113281, 431.23643493652344],
    [523.4459686279297, 421.59226989746094],
    [520.8709564208984, 411.9483337402344],
    [518.2958984375, 402.3043975830078],
    [515.7208404541016, 392.6602325439453],
    [513.1458282470703, 383.01629638671875],
    [510.57081604003906, 373.3723602294922],
    [507.9957580566406, 363.7281951904297],
    [505.4207000732422, 354.0842590332031],
    [502.84568786621094, 344.44032287597656],
    [500.2706298828125, 334.79620361328125],
    [497.69561767578125, 325.1522216796875],
    [495.1205596923828, 315.50828552246094],
    [492.5455017089844, 305.8641662597656],
    [489.9704895019531, 296.2201843261719],
    [487.3954772949219, 286.5762481689453],
    [484.82037353515625, 276.93212890625],
    [482.245361328125, 267.28814697265625],
    [479.67034912109375, 257.6442108154297],
    [477.0952911376953, 248.00009155273438],
    [474.5202331542969, 238.35610961914062],
    [471.9452209472656, 228.71217346191406],
    [469.3701629638672, 219.06805419921875],
    [466.79515075683594, 209.4240951538086],
    [464.2201385498047, 199.78013610839844],
    [461.64503479003906, 190.13600540161133],
    [459.0700225830078, 180.49205780029297],
    [456.49501037597656, 170.8480987548828],
    [453.9199523925781, 161.2039794921875],
    [451.3448944091797, 151.56002044677734],
    [448.76988220214844, 141.9160614013672],
    [446.19482421875, 132.27194213867188],
    [443.61981201171875, 122.62798309326172],
    [441.0447540283203, 112.98403549194336],
    [438.4696960449219, 103.33990478515625],
    [435.8946838378906, 93.69595146179199],
    [431.3629150390625, 86.59996795654297],
    [421.381103515625, 86.59996795654297],
    [411.39892578125, 86.59997367858887],
    [401.4171142578125, 86.59997367858887],
    [391.435302734375, 86.59997367858887],
    [381.4534912109375, 86.59997367858887],
    [371.4716796875, 86.59997940063477],
    [361.4898681640625, 86.59997940063477],
    [351.5076904296875, 86.59997940063477],
    [341.52587890625, 86.59997940063477],
    [331.5440673828125, 86.59998512268066],
    [321.562255859375, 86.59998512268066],
    [311.5804443359375, 86.59998512268066],
    [301.5986328125, 86.59998512268066],
    [291.616455078125, 86.59999084472656],
    [281.6346435546875, 86.59999084472656],
    [271.65283203125, 86.59999084472656],
    [261.6710205078125, 86.59999656677246],
    [251.689208984375, 86.59999656677246],
    [241.7073974609375, 86.59999656677246],
    [231.7252197265625, 86.59999656677246],
    [221.743408203125, 86.60000228881836],
    [211.7615966796875, 86.60000228881836],
    [204.9050636291504, 90.67578125],
    [202.31539154052734, 100.31582641601562],
    [199.7257194519043, 109.95587158203125],
    [197.13594436645508, 119.59623718261719],
    [194.54627227783203, 129.2362823486328],
    [191.95660018920898, 138.87628173828125],
    [189.36692810058594, 148.51632690429688],
    [186.7772560119629, 158.1563720703125],
    [184.18758392333984, 167.79637145996094],
    [181.59782028198242, 177.43675994873047],
    [179.00814819335938, 187.0767822265625],
    [176.41846466064453, 196.71682739257812],
    [173.82880401611328, 206.35684967041016],
    [171.23912048339844, 215.9968719482422],
    [168.6494483947754, 225.63689422607422],
    [166.05968475341797, 235.27728271484375],
    [163.47001266479492, 244.91732788085938],
    [160.88034057617188, 254.5573501586914],
    [158.29065704345703, 264.19737243652344],
    [155.70099639892578, 273.83739471435547],
    [153.11131286621094, 283.4774398803711],
    [150.52154922485352, 293.11780548095703],
    [147.93187713623047, 302.75785064697266],
    [145.34220504760742, 312.3978729248047],
    [142.75253295898438, 322.0378952026367],
    [140.16286087036133, 331.67794036865234],
    [137.57318878173828, 341.3179626464844],
    [134.98341369628906, 350.9583511352539],
    [132.3937530517578, 360.59837341308594],
    [129.80406951904297, 370.23839569091797],
    [127.21439743041992, 379.87841796875],
    [124.62472534179688, 389.5184631347656],
    [122.03505325317383, 399.15848541259766],
    [119.4452896118164, 408.7988739013672],
    [116.85560607910156, 418.4388732910156],
    [114.26593971252441, 428.07891845703125],
    [111.67626762390137, 437.7189636230469],
    [109.08659553527832, 447.3590087890625],
    [106.49691772460938, 456.99900817871094],
    [103.90715408325195, 466.6393737792969],
    [101.3174819946289, 476.2794189453125],
    [98.72780990600586, 485.9194641113281],
    [96.13813781738281, 495.55946350097656],
    [93.54846000671387, 505.1995086669922],
    [90.95878791809082, 514.8395538330078],
    [88.3690185546875, 524.4799194335938],
    [85.77934646606445, 534.1199645996094],
    [83.1896743774414, 543.7599639892578],
    [384.7999954223633, 350],
    [374.7674865722656, 349.9999771118164],
    [364.7349548339844, 349.9999771118164],
    [354.7024459838867, 349.9999771118164],
    [344.66991424560547, 349.9999771118164],
    [334.6374053955078, 349.9999771118164],
    [324.60487365722656, 350],
    [314.5723648071289, 350],
    [304.53985595703125, 350],
    [294.50732421875, 350],
    [284.47481536865234, 350],
    [274.4423065185547, 350],
    [264.40977478027344, 350],
    [254.3782501220703, 349.96537017822266],
    [246.9998550415039, 344.071044921875],
    [248.16605377197266, 334.2859573364258],
    [250.8531265258789, 324.61997985839844],
    [253.54017639160156, 314.9540252685547],
    [256.2272491455078, 305.28802490234375],
    [258.91432189941406, 295.6220703125],
    [261.6013946533203, 285.95609283447266],
    [264.28846740722656, 276.2901153564453],
    [266.9755172729492, 266.62413787841797],
    [269.66259002685547, 256.95813751220703],
    [272.3496627807617, 247.29218292236328],
    [275.03673553466797, 237.62618255615234],
    [277.7237854003906, 227.9602279663086],
    [280.4108581542969, 218.29425048828125],
    [283.0979309082031, 208.6282730102539],
    [285.7850036621094, 198.96229553222656],
    [288.4720764160156, 189.29631805419922],
    [292.13304138183594, 180.06887817382812],
    [301.3235626220703, 177.19999313354492],
    [311.35607147216797, 177.19999313354492],
    [321.3885803222656, 177.19999313354492],
    [331.4211120605469, 177.19999313354492],
    [341.45362091064453, 177.19999313354492],
    [349.44532775878906, 182.3175048828125],
    [352.26265716552734, 191.93919372558594],
    [354.9497299194336, 201.60518264770508],
    [357.63677978515625, 211.27112579345703],
    [360.3238525390625, 220.93710327148438],
    [363.01092529296875, 230.6031036376953],
    [365.697998046875, 240.26910400390625],
    [368.38504791259766, 249.9350357055664],
    [371.0721206665039, 259.60103607177734],
    [373.75919342041016, 269.2670135498047],
    [376.4462661743164, 278.93296813964844],
    [379.13333892822266, 288.5989456176758],
    [381.8203887939453, 298.2649459838867],
    [384.50746154785156, 307.93092346191406],
    [387.1945343017578, 317.5968780517578],
    [389.88160705566406, 327.26285552978516],
    [392.5686798095703, 336.9288558959961],
    [391.77938079833984, 346.51463317871094],
    [268.5202865600586, 333.2000045776367],
    [278.55281829833984, 333.2000045776367],
    [288.5853500366211, 333.2000045776367],
    [298.61783599853516, 333.2000045776367],
    [308.6503677368164, 333.2000045776367],
    [318.68289947509766, 333.2000045776367],
    [328.7153854370117, 333.2000045776367],
    [338.74791717529297, 333.2000045776367],
    [348.7804489135742, 333.2000045776367],
    [358.81298065185547, 333.2000045776367],
    [368.84546661376953, 333.2000045776367],
    [371.93148040771484, 327.9225158691406],
    [369.24200439453125, 318.2572021484375],
    [366.55252838134766, 308.59193420410156],
    [363.86305236816406, 298.92662048339844],
    [361.1735534667969, 289.2613067626953],
    [358.4840774536133, 279.5959701538086],
    [355.7946243286133, 269.93070220947266],
    [353.1051254272461, 260.26538848876953],
    [350.4156494140625, 250.6000518798828],
    [347.7261734008789, 240.93478393554688],
    [345.0366973876953, 231.26947021484375],
    [342.3472213745117, 221.60415649414062],
    [339.6577453613281, 211.9388313293457],
    [336.96826934814453, 202.27351760864258],
    [332.3097915649414, 195.20000457763672],
    [322.27725982666016, 195.20000457763672],
    [312.2447280883789, 195.20000457763672],
    [304.2526550292969, 197.88570404052734],
    [301.5631561279297, 207.55102920532227],
    [298.8736801147461, 217.2163543701172],
    [296.1842041015625, 226.8816680908203],
    [293.4947509765625, 236.54689025878906],
    [290.8052749633789, 246.2122039794922],
    [288.1157989501953, 255.8775405883789],
    [285.4263229370117, 265.54285430908203],
    [282.7368469238281, 275.20816802978516],
    [280.04734802246094, 284.8735046386719],
    [277.35787200927734, 294.538818359375],
    [274.66841888427734, 304.20404052734375],
    [271.97894287109375, 313.8693542480469],
    [269.28946685791016, 323.5346908569336],
  ];

  //   const guidePoints = guide.map(point => `${point.x},${point.y}`).join(' ');

  const guidePoints = guide.reduce((acc, coord, index) => {
    console.log('ðŸš€ ~ guidePoints ~ guidePoints:', guidePoints);
    const [x, y] = coord;
    return acc + (index === 0 ? `M${x},${y}` : `L${x},${y}`);
  }, '');

  const handleStrokeEnd = path => {
    if (path?.path?.length) {
      const isMatching = path.path.every(p =>
        isPointInPolygon({x: Math.round(p.x), y: Math.round(p.y)}, guide),
      );
      setFeedback(isMatching ? 'Well done! Shape matched.' : 'Keep trying!');
    } else {
      setFeedback('Draw something!');
    }
  };

  const recognizeText = async uri => {
    setIsRecognizing(true);
    try {
      const result = await textRecognition.recognize(uri);
      const text = result.text || 'No text recognized';
      setRecognizedText(text);
      setFeedback(
        text.includes('expected pattern')
          ? 'Perfect Match!'
          : "Text didn't match.",
      );
    } catch (error) {
      console.error('Recognition Error:', error);
      setFeedback('Error recognizing text!');
    } finally {
      setIsRecognizing(false);
    }
  };

  const handleSaveAndRecognize = async () => {
    try {
      const uri = await new Promise((resolve, reject) => {
        canvasRef.current.save(
          'png',
          false,
          'MySketch',
          `sketch_${Date.now()}`,
          true,
          true,
          true,
          (error, savedUri) => (error ? reject(error) : resolve(savedUri)),
        );
      });

      if (uri) {
        const localUri = `file://${uri}`;
        if (await RNFS.exists(localUri)) {
          await recognizeText(localUri);
        } else {
          throw new Error('File not found after save.');
        }
      } else {
        Alert.alert('Error', 'Canvas could not be saved!');
      }
    } catch (error) {
      console.error('Error saving canvas:', error);
      Alert.alert('Error', 'Failed to save the canvas!');
    }
  };

  return (
    <View style={styles.container}>
      {/* <Text style={styles.title}>Trace the Shape</Text> */}
      <Svg height="100%" width="100%" style={styles.svg}>
        <Path d={guidePoints} stroke="black" strokeWidth="2" fill="none" />
        {guide.map((coord, index) => (
          <Circle key={index} cx={coord[0]} cy={coord[1]} r={3} fill="blue" />
        ))}
      </Svg>
      {/* <SketchCanvas
        ref={canvasRef}
        style={styles.canvas}
        strokeColor="red"
        strokeWidth={4}
        onStrokeEnd={handleStrokeEnd}
      /> */}
      {/* <View style={styles.buttonContainer}>
        <Button title="Recognize Text" onPress={handleSaveAndRecognize} />
        <Button title="Clear" onPress={() => canvasRef.current.clear()} />
      </View>
      <Text style={styles.feedback}>{feedback}</Text>
      <Text style={styles.result}>
        {isRecognizing ? 'Recognizing...' : recognizedText || 'Start drawing!'}
      </Text> */}
    </View>
  );
};

const styles = StyleSheet.create({
  container: {
    flex: 1,
    alignItems: 'center',
    justifyContent: 'center',
  },
  title: {
    fontSize: 22,
    marginBottom: 20,
  },
  svg: {
    backgroundColor: 'red',
    position: 'absolute',
    top: 30,
    right: 50,
    alignSelf: 'center',
  },
  canvas: {
    width: 200,
    height: 200,
    backgroundColor: '#f5f5f5',
  },
  buttonContainer: {
    flexDirection: 'row',
    marginTop: 20,
    justifyContent: 'space-around',
    width: '80%',
  },
  feedback: {
    marginTop: 10,
    fontSize: 18,
    color: 'green',
  },
  result: {
    marginTop: 20,
    fontSize: 16,
    color: 'blue',
  },
});

export default RewardsScreen;
